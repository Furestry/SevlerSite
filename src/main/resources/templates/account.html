<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org" lang="en">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <title>SevlerSite - Account</title>

    <link href="/static/img/favicon.ico" rel="icon">
    <link href="/static/img/apple-touch-icon.png" rel="apple-touch-icon">

    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">

    <link href="/static/css/style.css" rel="stylesheet">
</head>
<body>
<section class="hero d-flex align-items-center">
    <div class="container py-5">
        <div class="row">
            <div class="col">
                <nav aria-label="breadcrumb" class="bg-light rounded-3 p-3 mb-4">
                    <ol class="breadcrumb mb-0">
                        <li class="breadcrumb-item"><a href="/">Home</a></li>
                        <li class="breadcrumb-item active" aria-current="page">User</li>
                    </ol>
                    <ol class="breadcrumbs mb-0">
                        <li class="breadcrumb-item"><a href="/logout">Logout</a></li>
                    </ol>
                </nav>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-4">
                <div class="card mb-4">
                    <div class="card-body text-center">
                        <form id="uploadForm" class="avatar-wrapper" method="post" th:action="@{/account/avatar}" enctype="multipart/form-data">
                            <img th:src="${userAvatar} != null ? ${'data:image;base64,' + userAvatar} : '/static/img/default_avatar.png'"
                                 alt="avatar" class="rounded-circle img-fluid profile-pic">
                            <div class="upload-button">
                                <i class="fa fa-arrow-circle-up" aria-hidden="true"></i>
                            </div>
                            <input class="file-upload" name="image" id="imageInput" type="file" accept="image/*"/>
                        </form>
                        <h5 class="my-3" th:text="${user.getUsername()}"></h5>
                    </div>
                </div>
            </div>
            <div class="col-lg-8">
                <div class="card mb-4">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-sm-3">
                                <p class="mb-0">Username</p>
                            </div>
                            <div class="col-sm-9">
                                <p class="text-muted mb-0" th:text="${user.getUsername()}"></p>
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-sm-3">
                                <p class="mb-0">Password</p>
                            </div>
                            <div class="col-sm-9">
                                <p class="text-muted mb-0">Change Password</p>
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-sm-3">
                                <p class="mb-0">JWT Token</p>
                            </div>
                            <div class="col-sm-9">
                                <p class="text-muted mb-0" th:object="${user.getToken()}"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<footer id="footer" class="footer">

    <div class="footer-top">
        <div class="container">
            <div class="row gy-4">
                <div class="col-lg-5 col-md-12 footer-info">
                    <a href="/" class="logo d-flex align-items-center">
                        <img src="/static/img/logo.png" alt="Logo">
                        <span>Sevler Site</span>
                    </a>
                    <p>Test Text.</p>
                    <div class="social-links mt-3">
                        <a href="https://github.com/Furestry" class="github"><i class="bi bi-github"></i></a>
                    </div>
                </div>

                <div class="col-lg-2 col-6 footer-links">
                    <h4>Useful Links</h4>
                    <ul>
                        <li><i class="bi bi-chevron-right"></i> <a href="/">Home</a></li>
                        <li><i class="bi bi-chevron-right"></i> <a href="/api">API</a></li>
                        <li><i class="bi bi-chevron-right"></i> <a href="/registration">Registration</a></li>
                    </ul>
                </div>

                <div class="col-lg-3 col-md-12 footer-contact text-center text-md-start" id="contact">
                    <h4>Contact Me</h4>
                    <p>
                        <strong>Telegram:</strong> @sevler<br>
                        <strong>Discord:</strong> Sevler#0099<br>
                        <strong>Email:</strong> sevler.u17@gmail.com<br>
                    </p>

                </div>

            </div>
        </div>
    </div>

    <div class="container">
        <div class="copyright">
            &copy; Powered by <strong><span><a href="https://github.com/Furestry" class="bi bi-github"> Sevler</a></span></strong>
        </div>
    </div>
</footer>

</body>

<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>

<script>
    $(document).ready(function() {
        let readURL = function(input) {
            if (input.files && input.files[0]) {
                let reader = new FileReader();

                reader.onload = function (e) {
                    $('#imageInput').attr('value', e.target.result);

                    let formData = new FormData();
                    formData.append('file', input.files[0]);

                    $.ajax({
                        type: 'POST',
                        url: 'account/avatar',
                        data: formData,
                        cache: false,
                        contentType: false,
                        processData: false,
                        success: function(){
                            $('#imageInput').attr('value', '');
                            $('.profile-pic').attr('src', e.target.result);
                        }
                    });
                    /**
                    $.ajax({
                        url: "/photo/upload/upload",
                        type: "POST",
                        dataType: 'text',
                        contentType: false,
                        processData: false,
                        cache: false,
                        data: formData,
                        success: function(response) {
                            alert("success");
                        },
                        error: function() {
                            alert("unable to create the record");
                        }**/
                }

                reader.readAsDataURL(input.files[0]);
            }
        }

        $(".file-upload").on('change', function(){
            readURL(this);
        });

        $(".upload-button").on('click', function() {
            $(".file-upload").click();
        });
    });
</script>

</html>