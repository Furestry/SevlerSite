const userId=Array.from(document.documentURI.split("/")).at(-1),commentsElem=document.getElementById("commentsList");let commentTemplate='<div class="card-body p-4">\n                          <div class="d-flex flex-start">\n                            <img class="rounded-circle shadow-1-strong me-3 comment-user-avatar"\n                                 src="%avatar%" alt="User Avatar" />\n                            <div>\n                              <h6 class="fw-bold mb-1 comment-username">%username%</h6>\n                              <div class="d-flex align-items-center mb-3" commentId=\'%commentId%\'>\n                                <p class="mb-0 comment-date">%date%</p>\n                                <a class="comment-edit" onclick="editComment(this)" data-bs-toggle="tooltip" title="'+edit+'">\n                                  <i class="bi bi-pencil-square ms-2"></i>\n                                </a>\n                                <a class="comment-delete" onclick="deleteComment(this)" data-bs-toggle="tooltip" title="'+delText+'">\n                                  <i class="bi bi-trash3 ms-2"></i>\n                                </a>\n                              </div>\n                              <p class="mb-0 comment-text">%text%</p>\n                            </div>\n                          </div>\n                        </div>\n                        <hr class="my-0" />',evtSource=new EventSource("/users/subscribe");function editComment(e){}function sendEditComment(e,t){$.ajax({type:"POST",url:"/users/comments?commentId="+e,data:t,cache:!1,contentType:!1,processData:!1})}function deleteComment(e){$.ajax({type:"DELETE",url:"/users/comments?commentId="+$(e).parent().attr("commentId"),cache:!1,contentType:!1,processData:!1})}evtSource.addEventListener("createComment",function(e){let t=JSON.parse(e.data);if(t.userId!=userId)return;let a;a=null!=t.avatar?"data:image;base64,"+t.avatar:"/static/img/default_avatar.png";let n=commentTemplate.replace("%username%",t.username).replace("%commentId%",t.id).replace("%text%",t.text).replace("%date%",t.date).replace("%avatar%",a);commentsElem.insertAdjacentHTML("beforeend",n);[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')).map(function(e){return new bootstrap.Tooltip(e)})}),evtSource.addEventListener("editComment",function(e){}),evtSource.addEventListener("deleteComment",function(e){let t=JSON.parse(e.data);t.userId==userId&&console.log(t)}),$(document).ready(function(){if(0!=commentsList.length){Array.from(commentsList).forEach(e=>{let t;t=null!=e.user.avatar?"data:image;base64,"+e.user.avatar:"/static/img/default_avatar.png";let a=commentTemplate.replace("%username%",e.user.username).replace("%text%",e.text).replace("%commentId%",e.id).replace("%date%",e.commentedAt.split("T")[0]).replace("%avatar%",t);commentsElem.insertAdjacentHTML("beforeend",a)});[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')).map(function(e){return new bootstrap.Tooltip(e)})}}),evtSource.onerror=function(e){switch(this.readyState){case EventSource.CONNECTING:break;case EventSource.CLOSED:evtSource=new EventSource("/users/subscribe")}},$("#addComment").on("keydown",function e(t){if(13==t.keyCode){let a=$(this).val();$.ajax({type:"PUT",url:"/users/comments?userId="+userId,data:a,cache:!1,contentType:!1,processData:!1})}});